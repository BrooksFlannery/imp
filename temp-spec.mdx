# Phase Analyzer Script Technical Specification

## 1. Overview

A simple script that reads a spec file and tells us which phases to spawn next. No AI interpretation needed.

## 2. Architecture Diagram

```mermaid
graph LR
    Spec[Spec.mdx]
    Analyzer[phase-analyzer.sh]
    Spawner[spawner.sh]
    
    Spec --> Analyzer
    Analyzer --> Spawner
```

## 3. Configuration

None needed. Just reads .mdx files with phase headers.

## 4. API / Protocol

### Command Line
```bash
./phase-analyzer.sh "spec-file.mdx"
# Returns: "Phase 1: Setup" "Phase 2: Backend"

# Use with spawner
./spawner.sh "spec-file.mdx" $(./phase-analyzer.sh "spec-file.mdx")
```

### Output
Space-separated phase names, quoted for shell safety.

### Exit Codes
- `0`: Found phases to spawn
- `1`: All phases complete
- `2`: File not found

## 5. Phases & Tasks

### Phase 1: Basic Parser
- [x] Parse markdown for phase headers (`### Phase X:`)
- [x] Check task completion (`[ ]` vs `[x]`)
- [x] Return incomplete phases in order
- [x] Handle basic errors

### Phase 2: Smart Dependencies
- [x] Detect parallel phases (same number, different letters)
- [x] Respect sequential dependencies (Phase 1 before Phase 2)
- [x] Return all phases that can be worked on now

### Phase 3: Integration
- [ ] Test with real spec files
- [ ] Update spawner to use analyzer
- [ ] Add error handling

## 6. Testing Strategy

A comprehensive test suite should be used to validate the analyzer's behavior. Each test should be a separate .mdx file with a variety of phase/task structures. The suite should include:

| Test File                | Description                                                      |
|-------------------------|------------------------------------------------------------------|
| test-spec-basic.mdx     | Simple sequential phases, no gaps, all tasks incomplete           |
| test-spec-parallel.mdx  | Includes parallel phases (e.g., 2a, 2b, 2c)                      |
| test-spec-gaps.mdx      | Gaps in phase numbers (e.g., 1, 3, 5)                            |
| test-spec-duplicates.mdx| Duplicate phase numbers or titles                                 |
| test-spec-malformed.mdx | Malformed headers, missing brackets, or invalid checklist syntax  |
| test-spec-complete.mdx  | All phases and tasks complete                                     |
| test-spec-mixed.mdx     | Mix of complete, incomplete, parallel, and sequential phases      |

For each test, run:
```bash
./phase-analyzer.sh <test-file>
```
And verify the output matches the expected available phases or error handling.

## 7. Success Criteria

- [ ] Correctly identifies next phases
- [ ] Works with existing spawner
- [ ] Handles errors gracefully
- [ ] Simple and reliable
